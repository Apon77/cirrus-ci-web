container:
  image: node:current

env:
  # see https://github.com/nodejs/node/blob/master/doc/changelogs/CHANGELOG_V17.md#17.0.0
  NODE_OPTIONS: --openssl-legacy-provider

task:
  experimental: true
  node_modules_cache:
    folder: node_modules
    fingerprint_script: cat yarn.lock
    populate_script: yarn
  bootstrap_script: yarn bootstrap
  matrix:
    - name: Build
      build_script: yarn build
      container:
        memory: 8G
    - name: Tests
      test_script: yarn test
    - name: Prettier
      prettier-check_script: yarn prettier-check
    - name: Type Check
      typecheck_script: yarn typecheck
